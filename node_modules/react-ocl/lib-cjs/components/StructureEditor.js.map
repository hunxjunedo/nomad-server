{"version":3,"file":"StructureEditor.js","names":["_full","_interopRequireDefault","require","_react","_interopRequireWildcard","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","StructureEditor","props","width","height","initialMolfile","initialIDCode","fragment","svgMenu","onChange","onAtomEnter","onAtomLeave","onBondEnter","onBondLeave","domRef","useRef","editorRef","editor","hadFirstChange","callbacksRef","useEffect","current","innerHTML","root","getRootNode","originalGetElementById","ShadowRoot","document","getElementById","bind","OCL","Error","setMolFile","setIDCode","setFragment","setChangeListenerCallback","args","setAtomHightlightCallback","onAtomHighlight","setBondHightlightCallback","onBondHighlight","molfile","getMolFileV3","molecule","getMolecule","idCode","getIDCode","atomId","enter","bondId","createElement","ref","style","_default","exports"],"sources":["../../src/components/StructureEditor.js"],"sourcesContent":["import OCL from 'openchemlib/full';\nimport React, { useRef, useEffect } from 'react';\n\nfunction StructureEditor(props) {\n  const {\n    width = 675,\n    height = 450,\n    initialMolfile = '',\n    initialIDCode = '',\n    fragment = false,\n    svgMenu = true,\n    onChange,\n    onAtomEnter,\n    onAtomLeave,\n    onBondEnter,\n    onBondLeave,\n  } = props;\n\n  const domRef = useRef();\n  const editorRef = useRef({ editor: null, hadFirstChange: false });\n  const callbacksRef = useRef({});\n\n  useEffect(() => {\n    domRef.current.innerHTML = '';\n\n    // GWT doesn't play well with the shadow DOM. This hack allows to load an\n    // OCL editor inside a shadow root.\n    const root = domRef.current.getRootNode();\n    let originalGetElementById;\n    if (root instanceof ShadowRoot) {\n      originalGetElementById = document.getElementById;\n      document.getElementById = root.getElementById.bind(root);\n    }\n    let editor;\n    try {\n      editor = new OCL.StructureEditor(domRef.current, svgMenu, 1);\n    } finally {\n      if (root instanceof ShadowRoot) {\n        document.getElementById = originalGetElementById;\n      }\n    }\n\n    editorRef.current.editor = editor;\n    if (initialMolfile && initialIDCode) {\n      throw new Error('Cannot specify both initialMolfile and initialIDCode');\n    }\n    if (initialMolfile) editor.setMolFile(initialMolfile);\n    if (initialIDCode) editor.setIDCode(initialIDCode);\n    editor.setFragment(fragment);\n    editor.setChangeListenerCallback((...args) => {\n      if (callbacksRef.current.onChange) {\n        callbacksRef.current.onChange(...args);\n      }\n    });\n    editor.setAtomHightlightCallback((...args) => {\n      if (callbacksRef.current.onAtomHighlight) {\n        callbacksRef.current.onAtomHighlight(...args);\n      }\n    });\n    editor.setBondHightlightCallback((...args) => {\n      if (callbacksRef.current.onBondHighlight) {\n        callbacksRef.current.onBondHighlight(...args);\n      }\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [width, height, svgMenu]);\n\n  useEffect(() => {\n    callbacksRef.current.onChange = () => {\n      if (!editorRef.current.hadFirstChange) {\n        editorRef.current.hadFirstChange = true;\n      } else if (onChange) {\n        const molfile = editorRef.current.editor.getMolFileV3();\n        const molecule = editorRef.current.editor.getMolecule();\n        const idCode = editorRef.current.editor.getIDCode();\n        onChange(molfile, molecule, idCode);\n      }\n    };\n    callbacksRef.current.onAtomHighlight = (atomId, enter) => {\n      if (enter && onAtomEnter) {\n        onAtomEnter(atomId);\n      } else if (!enter && onAtomLeave) {\n        onAtomLeave(atomId);\n      }\n    };\n    callbacksRef.current.onBondHighlight = (bondId, enter) => {\n      if (enter && onBondEnter) {\n        onBondEnter(bondId);\n      } else if (!enter && onBondLeave) {\n        onBondLeave(bondId);\n      }\n    };\n  }, [onChange, onAtomEnter, onAtomLeave, onBondEnter, onBondLeave]);\n\n  useEffect(() => {\n    if (editorRef.current.editor) {\n      editorRef.current.editor.setFragment(fragment);\n    }\n  }, [fragment]);\n\n  return <div ref={domRef} style={{ width, height }} />;\n}\n\nexport default StructureEditor;\n"],"mappings":";;;;;;AAAA,IAAAA,KAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,MAAA,GAAAC,uBAAA,CAAAF,OAAA;AAAiD,SAAAG,yBAAAC,WAAA,eAAAC,OAAA,kCAAAC,iBAAA,OAAAD,OAAA,QAAAE,gBAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,WAAA,WAAAA,WAAA,GAAAG,gBAAA,GAAAD,iBAAA,KAAAF,WAAA;AAAA,SAAAF,wBAAAM,GAAA,EAAAJ,WAAA,SAAAA,WAAA,IAAAI,GAAA,IAAAA,GAAA,CAAAC,UAAA,WAAAD,GAAA,QAAAA,GAAA,oBAAAA,GAAA,wBAAAA,GAAA,4BAAAE,OAAA,EAAAF,GAAA,UAAAG,KAAA,GAAAR,wBAAA,CAAAC,WAAA,OAAAO,KAAA,IAAAA,KAAA,CAAAC,GAAA,CAAAJ,GAAA,YAAAG,KAAA,CAAAE,GAAA,CAAAL,GAAA,SAAAM,MAAA,WAAAC,qBAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,GAAA,IAAAX,GAAA,QAAAW,GAAA,kBAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAd,GAAA,EAAAW,GAAA,SAAAI,IAAA,GAAAR,qBAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAV,GAAA,EAAAW,GAAA,cAAAI,IAAA,KAAAA,IAAA,CAAAV,GAAA,IAAAU,IAAA,CAAAC,GAAA,KAAAR,MAAA,CAAAC,cAAA,CAAAH,MAAA,EAAAK,GAAA,EAAAI,IAAA,YAAAT,MAAA,CAAAK,GAAA,IAAAX,GAAA,CAAAW,GAAA,SAAAL,MAAA,CAAAJ,OAAA,GAAAF,GAAA,MAAAG,KAAA,IAAAA,KAAA,CAAAa,GAAA,CAAAhB,GAAA,EAAAM,MAAA,YAAAA,MAAA;AAAA,SAAAf,uBAAAS,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAEjD,SAASiB,eAAeA,CAACC,KAAK,EAAE;EAC9B,MAAM;IACJC,KAAK,GAAG,GAAG;IACXC,MAAM,GAAG,GAAG;IACZC,cAAc,GAAG,EAAE;IACnBC,aAAa,GAAG,EAAE;IAClBC,QAAQ,GAAG,KAAK;IAChBC,OAAO,GAAG,IAAI;IACdC,QAAQ;IACRC,WAAW;IACXC,WAAW;IACXC,WAAW;IACXC;EACF,CAAC,GAAGX,KAAK;EAET,MAAMY,MAAM,GAAG,IAAAC,aAAM,EAAC,CAAC;EACvB,MAAMC,SAAS,GAAG,IAAAD,aAAM,EAAC;IAAEE,MAAM,EAAE,IAAI;IAAEC,cAAc,EAAE;EAAM,CAAC,CAAC;EACjE,MAAMC,YAAY,GAAG,IAAAJ,aAAM,EAAC,CAAC,CAAC,CAAC;EAE/B,IAAAK,gBAAS,EAAC,MAAM;IACdN,MAAM,CAACO,OAAO,CAACC,SAAS,GAAG,EAAE;;IAE7B;IACA;IACA,MAAMC,IAAI,GAAGT,MAAM,CAACO,OAAO,CAACG,WAAW,CAAC,CAAC;IACzC,IAAIC,sBAAsB;IAC1B,IAAIF,IAAI,YAAYG,UAAU,EAAE;MAC9BD,sBAAsB,GAAGE,QAAQ,CAACC,cAAc;MAChDD,QAAQ,CAACC,cAAc,GAAGL,IAAI,CAACK,cAAc,CAACC,IAAI,CAACN,IAAI,CAAC;IAC1D;IACA,IAAIN,MAAM;IACV,IAAI;MACFA,MAAM,GAAG,IAAIa,aAAG,CAAC7B,eAAe,CAACa,MAAM,CAACO,OAAO,EAAEb,OAAO,EAAE,CAAC,CAAC;IAC9D,CAAC,SAAS;MACR,IAAIe,IAAI,YAAYG,UAAU,EAAE;QAC9BC,QAAQ,CAACC,cAAc,GAAGH,sBAAsB;MAClD;IACF;IAEAT,SAAS,CAACK,OAAO,CAACJ,MAAM,GAAGA,MAAM;IACjC,IAAIZ,cAAc,IAAIC,aAAa,EAAE;MACnC,MAAM,IAAIyB,KAAK,CAAC,sDAAsD,CAAC;IACzE;IACA,IAAI1B,cAAc,EAAEY,MAAM,CAACe,UAAU,CAAC3B,cAAc,CAAC;IACrD,IAAIC,aAAa,EAAEW,MAAM,CAACgB,SAAS,CAAC3B,aAAa,CAAC;IAClDW,MAAM,CAACiB,WAAW,CAAC3B,QAAQ,CAAC;IAC5BU,MAAM,CAACkB,yBAAyB,CAAC,CAAC,GAAGC,IAAI,KAAK;MAC5C,IAAIjB,YAAY,CAACE,OAAO,CAACZ,QAAQ,EAAE;QACjCU,YAAY,CAACE,OAAO,CAACZ,QAAQ,CAAC,GAAG2B,IAAI,CAAC;MACxC;IACF,CAAC,CAAC;IACFnB,MAAM,CAACoB,yBAAyB,CAAC,CAAC,GAAGD,IAAI,KAAK;MAC5C,IAAIjB,YAAY,CAACE,OAAO,CAACiB,eAAe,EAAE;QACxCnB,YAAY,CAACE,OAAO,CAACiB,eAAe,CAAC,GAAGF,IAAI,CAAC;MAC/C;IACF,CAAC,CAAC;IACFnB,MAAM,CAACsB,yBAAyB,CAAC,CAAC,GAAGH,IAAI,KAAK;MAC5C,IAAIjB,YAAY,CAACE,OAAO,CAACmB,eAAe,EAAE;QACxCrB,YAAY,CAACE,OAAO,CAACmB,eAAe,CAAC,GAAGJ,IAAI,CAAC;MAC/C;IACF,CAAC,CAAC;IACF;EACF,CAAC,EAAE,CAACjC,KAAK,EAAEC,MAAM,EAAEI,OAAO,CAAC,CAAC;EAE5B,IAAAY,gBAAS,EAAC,MAAM;IACdD,YAAY,CAACE,OAAO,CAACZ,QAAQ,GAAG,MAAM;MACpC,IAAI,CAACO,SAAS,CAACK,OAAO,CAACH,cAAc,EAAE;QACrCF,SAAS,CAACK,OAAO,CAACH,cAAc,GAAG,IAAI;MACzC,CAAC,MAAM,IAAIT,QAAQ,EAAE;QACnB,MAAMgC,OAAO,GAAGzB,SAAS,CAACK,OAAO,CAACJ,MAAM,CAACyB,YAAY,CAAC,CAAC;QACvD,MAAMC,QAAQ,GAAG3B,SAAS,CAACK,OAAO,CAACJ,MAAM,CAAC2B,WAAW,CAAC,CAAC;QACvD,MAAMC,MAAM,GAAG7B,SAAS,CAACK,OAAO,CAACJ,MAAM,CAAC6B,SAAS,CAAC,CAAC;QACnDrC,QAAQ,CAACgC,OAAO,EAAEE,QAAQ,EAAEE,MAAM,CAAC;MACrC;IACF,CAAC;IACD1B,YAAY,CAACE,OAAO,CAACiB,eAAe,GAAG,CAACS,MAAM,EAAEC,KAAK,KAAK;MACxD,IAAIA,KAAK,IAAItC,WAAW,EAAE;QACxBA,WAAW,CAACqC,MAAM,CAAC;MACrB,CAAC,MAAM,IAAI,CAACC,KAAK,IAAIrC,WAAW,EAAE;QAChCA,WAAW,CAACoC,MAAM,CAAC;MACrB;IACF,CAAC;IACD5B,YAAY,CAACE,OAAO,CAACmB,eAAe,GAAG,CAACS,MAAM,EAAED,KAAK,KAAK;MACxD,IAAIA,KAAK,IAAIpC,WAAW,EAAE;QACxBA,WAAW,CAACqC,MAAM,CAAC;MACrB,CAAC,MAAM,IAAI,CAACD,KAAK,IAAInC,WAAW,EAAE;QAChCA,WAAW,CAACoC,MAAM,CAAC;MACrB;IACF,CAAC;EACH,CAAC,EAAE,CAACxC,QAAQ,EAAEC,WAAW,EAAEC,WAAW,EAAEC,WAAW,EAAEC,WAAW,CAAC,CAAC;EAElE,IAAAO,gBAAS,EAAC,MAAM;IACd,IAAIJ,SAAS,CAACK,OAAO,CAACJ,MAAM,EAAE;MAC5BD,SAAS,CAACK,OAAO,CAACJ,MAAM,CAACiB,WAAW,CAAC3B,QAAQ,CAAC;IAChD;EACF,CAAC,EAAE,CAACA,QAAQ,CAAC,CAAC;EAEd,oBAAO9B,MAAA,CAAAS,OAAA,CAAAgE,aAAA;IAAKC,GAAG,EAAErC,MAAO;IAACsC,KAAK,EAAE;MAAEjD,KAAK;MAAEC;IAAO;EAAE,CAAE,CAAC;AACvD;AAAC,IAAAiD,QAAA,GAEcpD,eAAe;AAAAqD,OAAA,CAAApE,OAAA,GAAAmE,QAAA"}