{"version":3,"file":"StructureEditor.js","names":["OCL","React","useRef","useEffect","StructureEditor","props","width","height","initialMolfile","initialIDCode","fragment","svgMenu","onChange","onAtomEnter","onAtomLeave","onBondEnter","onBondLeave","domRef","editorRef","editor","hadFirstChange","callbacksRef","current","innerHTML","root","getRootNode","originalGetElementById","ShadowRoot","document","getElementById","bind","Error","setMolFile","setIDCode","setFragment","setChangeListenerCallback","args","setAtomHightlightCallback","onAtomHighlight","setBondHightlightCallback","onBondHighlight","molfile","getMolFileV3","molecule","getMolecule","idCode","getIDCode","atomId","enter","bondId","createElement","ref","style"],"sources":["../../src/components/StructureEditor.js"],"sourcesContent":["import OCL from 'openchemlib/full';\nimport React, { useRef, useEffect } from 'react';\n\nfunction StructureEditor(props) {\n  const {\n    width = 675,\n    height = 450,\n    initialMolfile = '',\n    initialIDCode = '',\n    fragment = false,\n    svgMenu = true,\n    onChange,\n    onAtomEnter,\n    onAtomLeave,\n    onBondEnter,\n    onBondLeave,\n  } = props;\n\n  const domRef = useRef();\n  const editorRef = useRef({ editor: null, hadFirstChange: false });\n  const callbacksRef = useRef({});\n\n  useEffect(() => {\n    domRef.current.innerHTML = '';\n\n    // GWT doesn't play well with the shadow DOM. This hack allows to load an\n    // OCL editor inside a shadow root.\n    const root = domRef.current.getRootNode();\n    let originalGetElementById;\n    if (root instanceof ShadowRoot) {\n      originalGetElementById = document.getElementById;\n      document.getElementById = root.getElementById.bind(root);\n    }\n    let editor;\n    try {\n      editor = new OCL.StructureEditor(domRef.current, svgMenu, 1);\n    } finally {\n      if (root instanceof ShadowRoot) {\n        document.getElementById = originalGetElementById;\n      }\n    }\n\n    editorRef.current.editor = editor;\n    if (initialMolfile && initialIDCode) {\n      throw new Error('Cannot specify both initialMolfile and initialIDCode');\n    }\n    if (initialMolfile) editor.setMolFile(initialMolfile);\n    if (initialIDCode) editor.setIDCode(initialIDCode);\n    editor.setFragment(fragment);\n    editor.setChangeListenerCallback((...args) => {\n      if (callbacksRef.current.onChange) {\n        callbacksRef.current.onChange(...args);\n      }\n    });\n    editor.setAtomHightlightCallback((...args) => {\n      if (callbacksRef.current.onAtomHighlight) {\n        callbacksRef.current.onAtomHighlight(...args);\n      }\n    });\n    editor.setBondHightlightCallback((...args) => {\n      if (callbacksRef.current.onBondHighlight) {\n        callbacksRef.current.onBondHighlight(...args);\n      }\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [width, height, svgMenu]);\n\n  useEffect(() => {\n    callbacksRef.current.onChange = () => {\n      if (!editorRef.current.hadFirstChange) {\n        editorRef.current.hadFirstChange = true;\n      } else if (onChange) {\n        const molfile = editorRef.current.editor.getMolFileV3();\n        const molecule = editorRef.current.editor.getMolecule();\n        const idCode = editorRef.current.editor.getIDCode();\n        onChange(molfile, molecule, idCode);\n      }\n    };\n    callbacksRef.current.onAtomHighlight = (atomId, enter) => {\n      if (enter && onAtomEnter) {\n        onAtomEnter(atomId);\n      } else if (!enter && onAtomLeave) {\n        onAtomLeave(atomId);\n      }\n    };\n    callbacksRef.current.onBondHighlight = (bondId, enter) => {\n      if (enter && onBondEnter) {\n        onBondEnter(bondId);\n      } else if (!enter && onBondLeave) {\n        onBondLeave(bondId);\n      }\n    };\n  }, [onChange, onAtomEnter, onAtomLeave, onBondEnter, onBondLeave]);\n\n  useEffect(() => {\n    if (editorRef.current.editor) {\n      editorRef.current.editor.setFragment(fragment);\n    }\n  }, [fragment]);\n\n  return <div ref={domRef} style={{ width, height }} />;\n}\n\nexport default StructureEditor;\n"],"mappings":"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"}